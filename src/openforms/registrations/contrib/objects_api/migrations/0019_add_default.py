# Generated by Django 4.2.11 on 2024-05-28 10:14

from django.db import migrations


from django.db.migrations.state import StateApps
from django.db.backends.base.schema import BaseDatabaseSchemaEditor


def attach_default_objects_api_group(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    ObjectsAPIConfig = apps.get_model("registrations_objects_api", "ObjectsAPIConfig")
    ObjectsAPIGroupConfig = apps.get_model(
        "registrations_objects_api", "ObjectsAPIGroupConfig"
    )

    # There should be at most one (since it was created by migration 0017_move_singleton_data).
    # But in case that there are multiple, we just pick one.
    objects_api_group = ObjectsAPIGroupConfig.objects.first()
    if not objects_api_group:
        return

    solo_config = ObjectsAPIConfig.objects.get()
    solo_config.default_objects_api_group = objects_api_group
    solo_config.save()


class Migration(migrations.Migration):

    dependencies = [
        ("registrations_objects_api", "0018_alter_objectsapiconfig_options_and_more"),
    ]

    operations = [
        migrations.RunPython(
            attach_default_objects_api_group, migrations.RunPython.noop
        ),
    ]
